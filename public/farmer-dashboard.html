<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Farmer Dashboard - KrishiMitra</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="/css/enhanced.css" rel="stylesheet">
    <style>
        .dashboard-card {
            backdrop-filter: blur(10px);
            background: rgba(255, 255, 255, 0.95);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
        }
        .dashboard-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
        }
        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        .sidebar {
            backdrop-filter: blur(20px);
            background: rgba(255, 255, 255, 0.9);
        }
        .nav-item {
            transition: all 0.3s ease;
            cursor: pointer;
        }
        .nav-item:hover {
            background: rgba(16, 185, 129, 0.1);
            transform: translateX(5px);
        }
        .nav-item.active {
            background: rgba(16, 185, 129, 0.2);
            border-right: 3px solid #10b981;
        }
        .chatbot-toggle {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
        }
        .chatbot-panel {
            position: fixed;
            bottom: 80px;
            right: 20px;
            width: 350px;
            height: 500px;
            z-index: 999;
            transform: translateX(400px);
            transition: transform 0.3s ease;
        }
        .chatbot-panel.open {
            transform: translateX(0);
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Header -->
    <nav class="bg-white shadow-lg border-b border-gray-200">
        <div class="px-6 py-4">
            <div class="flex justify-between items-center">
                <div class="flex items-center space-x-4">
                    <div class="flex items-center space-x-3">
                        <i class="fas fa-seedling text-2xl text-green-600"></i>
                        <h1 class="text-2xl font-bold text-gray-800">KrishiMitra</h1>
                    </div>
                    <span class="text-sm text-gray-500">|</span>
                    <span class="text-lg font-medium text-gray-700">Farmer Dashboard</span>
                </div>
                
                <div class="flex items-center space-x-4">
                    <!-- Language Selector -->
                    <select class="language-selector bg-gray-100 border rounded px-3 py-1 text-sm" onchange="changeLanguage(this.value)">
                        <option value="en">English</option>
                        <option value="hi">हिन्दी</option>
                        <option value="mr">मराठी</option>
                    </select>
                    
                    <!-- Voice Controls -->
                    <button id="voiceInputBtn" onclick="toggleVoiceInput()" class="bg-blue-600 text-white px-3 py-2 rounded-lg hover:bg-blue-700 transition flex items-center space-x-1" title="Voice Input">
                        <i class="fas fa-microphone"></i>
                        <span class="btn-text hidden lg:inline text-xs">Voice</span>
                    </button>
                    <!-- Account Balance -->
                    <div class="text-right">
                        <p class="text-sm text-gray-500">Account Balance</p>
                        <p class="text-lg font-bold text-green-600" id="accountBalance">₹0</p>
                    </div>
                    
                    <!-- User Profile -->
                    <div class="flex items-center space-x-3">
                        <div class="text-right">
                            <p class="text-sm font-medium text-gray-700" id="userName">Loading...</p>
                            <p class="text-xs text-gray-500" id="userId">ID: ...</p>
                        </div>
                        <div class="w-10 h-10 bg-green-600 rounded-full flex items-center justify-center">
                            <i class="fas fa-user text-white"></i>
                        </div>
                        <button onclick="logout()" class="text-red-600 hover:text-red-800 ml-2">
                            <i class="fas fa-sign-out-alt"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Container -->
    <div class="flex">
        <!-- Sidebar -->
        <div class="sidebar w-64 min-h-screen border-r border-gray-200 p-4">
            <div class="space-y-2">
                <div class="nav-item active px-4 py-3 rounded-lg" data-section="overview">
                    <i class="fas fa-chart-pie mr-3"></i>Overview
                </div>
                <div class="nav-item px-4 py-3 rounded-lg" data-section="warehouses">
                    <i class="fas fa-warehouse mr-3"></i>Nearby Warehouses
                </div>
                <div class="nav-item px-4 py-3 rounded-lg" data-section="doculocker">
                    <i class="fas fa-folder-open mr-3"></i>DocuLocker
                </div>
                <div class="nav-item px-4 py-3 rounded-lg" data-section="auction">
                    <i class="fas fa-gavel mr-3"></i>Auction Center
                </div>
                <div class="nav-item px-4 py-3 rounded-lg" data-section="loans">
                    <i class="fas fa-hand-holding-usd mr-3"></i>Loans
                </div>
                <div class="nav-item px-4 py-3 rounded-lg" data-section="transactions">
                    <i class="fas fa-receipt mr-3"></i>Transactions
                </div>
                <div class="nav-item px-4 py-3 rounded-lg" data-section="account">
                    <i class="fas fa-user-circle mr-3"></i>Account Settings
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="flex-1 p-6">
            <!-- Overview Section -->
            <div id="overview" class="section">
                <div class="mb-6">
                    <h2 class="text-3xl font-bold text-gray-800 mb-2">Welcome back, <span id="welcomeName">Farmer</span>!</h2>
                    <p class="text-gray-600">Here's your farming and financial overview</p>
                </div>

                <!-- Stats Grid -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                    <div class="stat-card dashboard-card rounded-xl p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm opacity-90">Active WHRs</p>
                                <p class="text-2xl font-bold" id="activeWHRs">0</p>
                            </div>
                            <i class="fas fa-file-contract text-3xl opacity-80"></i>
                        </div>
                    </div>
                    
                    <div class="stat-card dashboard-card rounded-xl p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm opacity-90">Total Loans</p>
                                <p class="text-2xl font-bold" id="totalLoans">₹0</p>
                            </div>
                            <i class="fas fa-coins text-3xl opacity-80"></i>
                        </div>
                    </div>
                    
                    <div class="stat-card dashboard-card rounded-xl p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm opacity-90">Credit Score</p>
                                <p class="text-2xl font-bold" id="creditScore">750</p>
                            </div>
                            <i class="fas fa-chart-line text-3xl opacity-80"></i>
                        </div>
                    </div>
                    
                    <div class="stat-card dashboard-card rounded-xl p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm opacity-90" >This Month</p>
                                <p class="text-2xl font-bold" id="monthlyEarnings">₹0</p>
                            </div>
                            <i class="fas fa-rupee-sign text-3xl opacity-80"></i>
                        </div>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    <div class="dashboard-card rounded-xl p-6">
                        <h3 class="text-lg font-semibold mb-4 text-gray-800" >
                            <i class="fas fa-warehouse text-green-600 mr-2"></i>Find Warehouses
                        </h3>
                        <p class="text-gray-600 mb-4" >Discover nearby warehouses for crop storage</p>
                        <button onclick="switchSection('warehouses')" class="enhanced-btn px-4 py-2 w-full" >
                            View Warehouses
                        </button>
                    </div>

                    <div class="dashboard-card rounded-xl p-6">
                        <h3 class="text-lg font-semibold mb-4 text-gray-800">
                            <i class="fas fa-gavel text-blue-600 mr-2"></i>Start Auction
                        </h3>
                        <p class="text-gray-600 mb-4">Put your crops up for auction</p>
                        <button onclick="switchSection('auction')" class="enhanced-btn px-4 py-2 w-full">
                            Create Auction
                        </button>
                    </div>

                    <div class="dashboard-card rounded-xl p-6">
                        <h3 class="text-lg font-semibold mb-4 text-gray-800">
                            <i class="fas fa-hand-holding-usd text-purple-600 mr-2"></i>Get Loan
                        </h3>
                        <p class="text-gray-600 mb-4" >Apply for loan against your WHR</p>
                        <button onclick="switchSection('loans')" class="enhanced-btn px-4 py-2 w-full" >
                            Apply for Loan
                        </button>
                    </div>
                </div>
            </div>

            <!-- Warehouses Section -->
            <div id="warehouses" class="section hidden">
                <div class="mb-6">
                    <h2 class="text-3xl font-bold text-gray-800 mb-2">Nearby Warehouses</h2>
                    <p class="text-gray-600">Find warehouses near your location for crop storage</p>
                </div>

                <!-- Location Filter -->
                <div class="dashboard-card rounded-xl p-6 mb-6">
                    <div class="flex items-center space-x-4">
                        <div class="flex-1">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Your Location</label>
                            <input type="text" id="farmerLocation" class="enhanced-input w-full" 
                                   placeholder="Enter your city or pincode">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Radius</label>
                            <select id="searchRadius" class="enhanced-input">
                                <option value="10">10 km</option>
                                <option value="25" selected>25 km</option>
                                <option value="50">50 km</option>
                                <option value="100">100 km</option>
                            </select>
                        </div>
                        <div class="pt-6">
                            <button onclick="searchWarehouses()" class="enhanced-btn px-6 py-2">
                                <i class="fas fa-search mr-2"></i>Search
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Warehouses List -->
                <div id="warehousesList" class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <!-- Warehouses will be loaded here -->
                </div>
            </div>

            <!-- DocuLocker Section -->
            <div id="doculocker" class="section hidden">
                <div class="mb-6">
                    <h2 class="text-3xl font-bold text-gray-800 mb-2">DocuLocker</h2>
                    <p class="text-gray-600">Manage your warehouse receipts and documents</p>
                </div>

                <!-- WHR Status Filter -->
                <div class="dashboard-card rounded-xl p-4 mb-6">
                    <div class="flex items-center space-x-4">
                        <span class="text-sm font-medium text-gray-700">Filter by status:</span>
                        <button class="whr-filter active px-3 py-1 rounded-full text-sm" data-status="all">All</button>
                        <button class="whr-filter px-3 py-1 rounded-full text-sm" data-status="active">Available</button>
                        <button class="whr-filter px-3 py-1 rounded-full text-sm" data-status="locked_for_loan">Locked</button>
                        <button class="whr-filter px-3 py-1 rounded-full text-sm" data-status="sold">Sold</button>
                    </div>
                </div>

                <!-- WHR List -->
                <div id="whrList" class="space-y-4">
                    <!-- WHRs will be loaded here -->
                </div>
            </div>

            <!-- Auction Section -->
            <div id="auction" class="section hidden">
                <div class="mb-6">
                    <h2 class="text-3xl font-bold text-gray-800 mb-2">Auction Center</h2>
                    <p class="text-gray-600">Put your crops up for auction and get the best prices</p>
                </div>

                <!-- Create Auction -->
                <div class="dashboard-card rounded-xl p-6 mb-6">
                    <h3 class="text-xl font-semibold mb-4">Create New Auction</h3>
                    
                    <form id="auctionForm" class="space-y-4">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Select WHR</label>
                                <select id="auctionWHR" required class="enhanced-input w-full">
                                    <option value="">Select a warehouse receipt</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Base Price (₹)</label>
                                <input type="number" id="basePrice" required class="enhanced-input w-full" 
                                       placeholder="Minimum acceptable price">
                            </div>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Auction Duration</label>
                            <select id="auctionDuration" class="enhanced-input w-full">
                                <option value="30">30 seconds (Demo)</option>
                                <option value="60">1 minute (Demo)</option>
                            </select>
                        </div>
                        
                        <button type="submit" class="enhanced-btn px-6 py-3">
                            <i class="fas fa-gavel mr-2"></i>Start Auction
                        </button>
                    </form>
                </div>

                <!-- Active Auctions -->
                <div id="activeAuctions" class="space-y-4">
                    <!-- Active auctions will be shown here -->
                </div>
            </div>

            <!-- Loans Section -->
            <div id="loans" class="section hidden">
                <div class="mb-6">
                    <h2 class="text-3xl font-bold text-gray-800 mb-2">Loan Management</h2>
                    <p class="text-gray-600">Apply for loans against your warehouse receipts</p>
                </div>

                <!-- Loan Application -->
                <div class="dashboard-card rounded-xl p-6 mb-6">
                    <h3 class="text-xl font-semibold mb-4">Apply for Loan</h3>
                    
                    <form id="loanForm" class="space-y-4">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Select WHR as Collateral</label>
                                <select id="loanWHR" required class="enhanced-input w-full">
                                    <option value="">Select warehouse receipt</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Loan Purpose</label>
                                <select id="loanPurpose" required class="enhanced-input w-full">
                                    <option value="">Select purpose</option>
                                    <option value="farming_inputs">Farming Inputs</option>
                                    <option value="family_expenses">Family Expenses</option>
                                    <option value="business_expansion">Business Expansion</option>
                                    <option value="emergency">Emergency</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Requested Amount (₹)</label>
                                <input type="number" id="requestedAmount" required class="enhanced-input w-full" 
                                       placeholder="Enter loan amount">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Tenure (months)</label>
                                <select id="loanTenure" class="enhanced-input w-full">
                                    <option value="6">6 months</option>
                                    <option value="12" selected>12 months</option>
                                    <option value="18">18 months</option>
                                    <option value="24">24 months</option>
                                </select>
                            </div>
                        </div>
                        
                        <div id="loanCalculation" class="hidden bg-blue-50 p-4 rounded-lg">
                            <h4 class="font-semibold text-blue-800 mb-2">Loan Details:</h4>
                            <div class="grid grid-cols-2 gap-4 text-sm text-blue-700">
                                <div>Eligible Amount: <span id="eligibleAmount">₹0</span></div>
                                <div>Interest Rate: <span id="interestRate">12% per annum</span></div>
                                <div>Total Interest: <span id="totalInterest">₹0</span></div>
                                <div>Total Repayment: <span id="totalRepayment">₹0</span></div>
                            </div>
                        </div>
                        
                        <button type="submit" class="enhanced-btn px-6 py-3">
                            <i class="fas fa-hand-holding-usd mr-2"></i>Apply for Loan
                        </button>
                    </form>
                </div>

                <!-- Active Loans -->
                <div id="activeLoans" class="space-y-4">
                    <!-- Active loans will be shown here -->
                </div>
            </div>

            <!-- Transactions Section -->
            <div id="transactions" class="section hidden">
                <div class="mb-6">
                    <h2 class="text-3xl font-bold text-gray-800 mb-2">Transaction History</h2>
                    <p class="text-gray-600">View all your financial transactions</p>
                </div>

                <!-- Transaction Filters -->
                <div class="dashboard-card rounded-xl p-4 mb-6">
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Type</label>
                            <select id="transactionType" class="enhanced-input w-full">
                                <option value="">All Types</option>
                                <option value="auction_payment">Auction Payment</option>
                                <option value="loan_disbursement">Loan Disbursement</option>
                                <option value="loan_repayment">Loan Repayment</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2" >From Date</label>
                            <input type="date" id="fromDate" class="enhanced-input w-full">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">To Date</label>
                            <input type="date" id="toDate" class="enhanced-input w-full">
                        </div>
                        <div class="pt-6">
                            <button onclick="filterTransactions()" class="enhanced-btn px-6 py-2 w-full" >
                                Filter
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Transactions List -->
                <div id="transactionsList" class="space-y-4">
                    <!-- Transactions will be loaded here -->
                </div>
            </div>

            <!-- Account Section -->
            <div id="account" class="section hidden">
                <div class="mb-6">
                    <h2 class="text-3xl font-bold text-gray-800 mb-2">Account Settings</h2>
                    <p class="text-gray-600">Manage your profile and preferences</p>
                </div>

                <!-- Profile Information -->
                <div class="dashboard-card rounded-xl p-6">
                    <h3 class="text-xl font-semibold mb-4">Profile Information</h3>
                    <div id="profileInfo" class="space-y-4">
                        <!-- Profile details will be loaded here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Chatbot Toggle -->
    <button class="chatbot-toggle enhanced-btn rounded-full w-14 h-14 flex items-center justify-center" 
            onclick="toggleChatbot()">
        <i class="fas fa-comments text-xl"></i>
    </button>

    <!-- Chatbot Panel -->
    <div id="chatbotPanel" class="chatbot-panel dashboard-card rounded-l-xl">
        <div class="bg-green-600 text-white p-4 rounded-tl-xl">
            <div class="flex justify-between items-center mb-2">
                <h3 class="font-semibold">KrishiMitra Assistant</h3>
                <button onclick="toggleChatbot()" class="text-white hover:text-gray-200">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="flex items-center space-x-2 text-sm">
                <span>Language:</span>
                <select id="chatLanguage" class="bg-green-700 text-white rounded px-2 py-1 text-xs border-none" onchange="updateChatLanguage()">
                    <option value="en">English</option>
                    <option value="hi">हिन्दी</option>
                    <option value="mr">मराठी</option>
                </select>
            </div>
        </div>
        <div id="chatbotContent" class="h-96 p-4 overflow-y-auto">
            <div class="text-center text-gray-500 mt-8">
                <i class="fas fa-robot text-4xl mb-4"></i>
                <p class="mb-4">Hi! I'm your farming assistant. How can I help you today?</p>
                <div class="text-xs space-y-1 text-left max-w-xs mx-auto">
                    <p class="font-semibold">Try asking:</p>
                    <p class="cursor-pointer hover:text-green-600" onclick="quickQuestion('How can I take loans against my crop?')">• How to get crop loans?</p>
                    <p class="cursor-pointer hover:text-green-600" onclick="quickQuestion('What are today\'s wheat prices?')">• Today's wheat prices?</p>
                    <p class="cursor-pointer hover:text-green-600" onclick="quickQuestion('How to use this app for financial planning?')">• Financial planning help?</p>
                    <p class="cursor-pointer hover:text-green-600" onclick="quickQuestion('मुझे वित्तीय सलाह चाहिए')">• मुझे वित्तीय सलाह चाहिए</p>
                </div>
            </div>
        </div>
        <div class="p-4 border-t">
            <div class="flex space-x-2">
                <input type="text" id="chatInput" class="enhanced-input flex-1" 
                       placeholder="Ask me anything..." onkeypress="handleChatKeyPress(event)" >
                <button id="voiceChatBtn" onclick="toggleVoiceInput()" class="bg-blue-600 text-white px-3 py-2 rounded hover:bg-blue-700 transition" title="Voice Input">
                    <i class="fas fa-microphone"></i>
                </button>
                <button id="speakerBtn" onclick="speakLastMessage()" class="bg-green-600 text-white px-3 py-2 rounded hover:bg-green-700 transition" title="Speak Response">
                    <i class="fas fa-volume-up"></i>
                </button>
                <button onclick="sendChatMessage()" class="enhanced-btn px-4 py-2">
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white rounded-lg p-6 text-center">
            <div class="loading-spinner mx-auto mb-4"></div>
            <p class="text-gray-700" >Processing...</p>
        </div>
    </div>

    <script src="/js/particles.js"></script>
    <script src="/js/translations.js"></script>
    <script src="/js/voice-manager.js"></script>
    <script src="/js/farmer-dashboard.js"></script>
</body>
</html> 